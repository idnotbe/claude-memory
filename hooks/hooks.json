{
  "description": "v3.0.0: 6 triage-only Stop hooks (Haiku evaluates, main agent writes) + 1 command retrieval hook (Python). See SKILL.md for file format instructions.",
  "hooks": {
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "timeout": 30,
            "statusMessage": "Checking for session summary...",
            "prompt": "You evaluate whether meaningful work was completed in this conversation turn.\n\nHook input: $ARGUMENTS\n\nRULES:\n1. If stop_hook_active is true in the input above, approve immediately.\n2. Evaluate: Was a specific task completed, a file modified with intent, or a project decision made? Ignore trivial interactions (greetings, simple Q&A, pure exploration without conclusions).\n3. If no meaningful work, approve.\n4. If meaningful work occurred, block and set reason to: \"Save a SESSION_SUMMARY memory capturing: <summarize work in 1 sentence>. Only keep the latest session summary -- overwrite any previous one. Check .claude/memory/index.md for the existing session entry. Use memory-management skill for JSON format and file paths.\""
          }
        ]
      },
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "timeout": 30,
            "statusMessage": "Checking for decisions...",
            "prompt": "You evaluate whether a decision was made in this conversation turn.\n\nHook input: $ARGUMENTS\n\nRULES:\n1. If stop_hook_active is true in the input above, approve immediately.\n2. Evaluate: Was a choice made between alternatives with stated rationale? Must have a clear 'chose X because Y' pattern -- not just discussion of options.\n3. If no decision was made, approve.\n4. If a decision was made, block and set reason to: \"Save a DECISION memory about: <summarize decision in 1 sentence>. Check .claude/memory/index.md for existing entries to update rather than duplicate. Use memory-management skill for JSON format and file paths.\""
          }
        ]
      },
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "timeout": 30,
            "statusMessage": "Checking for runbook entries...",
            "prompt": "You evaluate whether an error was fully resolved in this conversation turn.\n\nHook input: $ARGUMENTS\n\nRULES:\n1. If stop_hook_active is true in the input above, approve immediately.\n2. Evaluate: Was a non-trivial error (a) diagnosed with root cause, (b) fixed, AND (c) verified working? All three are required.\n3. If not all three present, approve.\n4. If fully resolved, block and set reason to: \"Save a RUNBOOK memory for: <error symptom and fix in 1 sentence>. Check .claude/memory/index.md for existing entries to update. Use memory-management skill for JSON format and file paths.\""
          }
        ]
      },
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "timeout": 30,
            "statusMessage": "Checking for constraints...",
            "prompt": "You evaluate whether a persistent limitation was discovered in this conversation turn.\n\nHook input: $ARGUMENTS\n\nRULES:\n1. If stop_hook_active is true in the input above, approve immediately.\n2. Evaluate: Was an enduring limitation from external factors discovered (API limits, platform restrictions, legal requirements, infrastructure constraints)? Must be a persistent wall, not a temporary blocker or fixable bug.\n3. If no constraint discovered, approve.\n4. If a constraint was discovered, block and set reason to: \"Save a CONSTRAINT memory about: <the limitation and its impact in 1 sentence>. Check .claude/memory/index.md for existing entries to update. Use memory-management skill for JSON format and file paths.\""
          }
        ]
      },
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "timeout": 30,
            "statusMessage": "Checking for tech debt...",
            "prompt": "You evaluate whether work was explicitly deferred in this conversation turn.\n\nHook input: $ARGUMENTS\n\nRULES:\n1. If stop_hook_active is true in the input above, approve immediately.\n2. Evaluate: Was work explicitly deferred with acknowledged cost or risk? Must have a clear 'deferring X because Y' pattern -- not just a TODO or wish list item.\n3. If nothing was deferred, approve.\n4. If work was deferred, block and set reason to: \"Save a TECH_DEBT memory about: <what was deferred and why in 1 sentence>. Check .claude/memory/index.md for existing entries to update. Use memory-management skill for JSON format and file paths.\""
          }
        ]
      },
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "timeout": 30,
            "statusMessage": "Checking for preferences...",
            "prompt": "You evaluate whether a new convention was established in this conversation turn.\n\nHook input: $ARGUMENTS\n\nRULES:\n1. If stop_hook_active is true in the input above, approve immediately.\n2. Evaluate: Was a new convention deliberately established for future consistency? Must be a style, tool, or workflow choice intended to apply going forward -- not following an existing convention or a one-time exception.\n3. If no new convention, approve.\n4. If a new convention was established, block and set reason to: \"Save a PREFERENCE memory about: <the convention and rationale in 1 sentence>. Check .claude/memory/index.md for existing entries to update. Use memory-management skill for JSON format and file paths.\""
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "python \"$CLAUDE_PLUGIN_ROOT/hooks/scripts/memory_retrieve.py\"",
            "timeout": 10,
            "statusMessage": "Retrieving relevant memories..."
          }
        ]
      }
    ]
  }
}
